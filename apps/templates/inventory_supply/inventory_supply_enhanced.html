{% extends 'dashboard.html' %}

{% block content %}

<!-- TEST: Enhanced template is loading -->
<div style="background: red; color: white; padding: 10px; margin: 10px; text-align: center; font-weight: bold;">
  🎉 ENHANCED TEMPLATE IS LOADING! 🎉
</div>

<!-- TEST BUTTONS -->
<div style="padding: 20px; text-align: center;">
  <button id="testBtn" style="background: green; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 5px;">
    🧪 TEST BUTTON - Click Me!
  </button>
  <button id="testModalBtn" style="background: purple; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 5px;">
    🔧 TEST MODAL - Show Modal
  </button>
</div>

<script src="https://unpkg.com/@tailwindcss/browser@4"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- jQuery UI CSS (for styling the autocomplete dropdown) -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">

<!-- jQuery UI JavaScript -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<link href="https://cdn.datatables.net/v/dt/jszip-3.10.1/dt-2.1.4/b-3.1.1/b-html5-3.1.1/datatables.min.css" rel="stylesheet">
 
<script src="https://cdn.datatables.net/v/dt/jszip-3.10.1/dt-2.1.4/b-3.1.1/b-html5-3.1.1/datatables.min.js"></script>

<!-- Custom CSS for enhanced styling -->
<style>
  .gradient-bg {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  .card-shadow {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  .btn-primary-custom {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    transition: all 0.3s ease;
  }
  
  .btn-primary-custom:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
  }
  
  .btn-success-custom {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    border: none;
    transition: all 0.3s ease;
  }
  
  .btn-success-custom:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(79, 172, 254, 0.4);
  }
  
  .table-modern {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }
  
  .table-modern thead {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  .modal-modern {
    backdrop-filter: blur(10px);
  }
  
  .form-input-modern {
    transition: all 0.3s ease;
    border: 2px solid #e2e8f0;
  }
  
  .form-input-modern:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
  }

  .stats-card {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    border-radius: 16px;
    padding: 1.5rem;
    color: white;
    transition: transform 0.3s ease;
  }

  .stats-card:hover {
    transform: translateY(-5px);
  }

  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    color: white;
  }
</style>

<link rel="stylesheet" type="text/css" href="/static/style.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

<!-- Page Header -->
<div class="page-header">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold mb-2">
        <i class="fas fa-boxes mr-3"></i>Inventory Supply Management
      </h1>
      <p class="text-blue-100">Manage your inventory items and supplies efficiently</p>
    </div>
    <div class="stats-card">
      <div class="text-center">
        <div class="text-2xl font-bold" id="totalItems">0</div>
        <div class="text-sm opacity-90">Total Items</div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Modal for Updating Inventory -->
<div id="supplierModalUpdating" role="dialog" aria-modal="true" aria-labelledby="dialog-title" class="relative z-50 hidden modal-modern" style="display: none;">
  <div aria-hidden="true" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"></div>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all w-full max-w-2xl card-shadow">
        
        <!-- Modal Header -->
        <div class="gradient-bg px-6 py-4">
          <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-white/20 mr-4">
              <i class="fas fa-edit text-white text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-white">Update Inventory Item</h3>
              <p class="text-blue-100 text-sm">Modify inventory item details</p>
            </div>
          </div>
        </div>

        <!-- Modal Body -->
        <div class="px-6 py-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Hidden ID field -->
            <input hidden type="text" id="idUpdate" class="form-input-modern">
            
            <!-- Item Code -->
            <div class="space-y-2">
              <label for="item_code_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-barcode text-blue-500 mr-2"></i>Item Code
              </label>
              <input type="text" id="item_code_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Name -->
            <div class="space-y-2">
              <label for="nameUpdate" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-tag text-green-500 mr-2"></i>Item Name
              </label>
              <input type="text" id="nameUpdate" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Category -->
            <div class="space-y-2">
              <label for="category_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-layer-group text-purple-500 mr-2"></i>Category
              </label>
              <input type="text" id="category_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Quantity -->
            <div class="space-y-2">
              <label for="quantity_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-cubes text-orange-500 mr-2"></i>Quantity
              </label>
              <input type="number" id="quantity_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Unit -->
            <div class="space-y-2">
              <label for="unit_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-ruler text-indigo-500 mr-2"></i>Unit
              </label>
              <input type="text" id="unit_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Reorder Level -->
            <div class="space-y-2">
              <label for="reorder_level_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Reorder Level
              </label>
              <input type="number" id="reorder_level_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Price -->
            <div class="space-y-2">
              <label for="price_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-dollar-sign text-green-600 mr-2"></i>Price per Unit
              </label>
              <input type="number" step="0.01" id="price_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Supplier -->
            <div class="space-y-2">
              <label for="supplier_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-truck text-blue-600 mr-2"></i>Supplier
              </label>
              <input type="text" id="supplier_update" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm">
            </div>

            <!-- Description (full width) -->
            <div class="md:col-span-2 space-y-2">
              <label for="description_update" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-align-left text-gray-500 mr-2"></i>Description
              </label>
              <textarea id="description_update" rows="3" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm resize-none"></textarea>
            </div>

          </div>
        </div>

        <!-- Modal Footer -->
        <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3">
          <button id="updateCancelBtn" type="button" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition-all duration-300 close-modal">
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
          <button id="updateBtn" type="button" class="px-6 py-3 btn-primary-custom text-white font-semibold rounded-lg">
            <i class="fas fa-save mr-2"></i>Update Item
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Modal for Adding New Inventory -->
<div id="supplierModal" role="dialog" aria-modal="true" aria-labelledby="dialog-title" class="relative z-50 hidden modal-modern" style="display: none;">
  <div aria-hidden="true" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity"></div>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all w-full max-w-2xl card-shadow">

        <!-- Modal Header -->
        <div class="gradient-bg px-6 py-4">
          <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-white/20 mr-4">
              <i class="fas fa-plus text-white text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-white">Add New Inventory Item</h3>
              <p class="text-blue-100 text-sm">Create a new inventory item</p>
            </div>
          </div>
        </div>

        <!-- Modal Body -->
        <div class="px-6 py-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- Item Code -->
            <div class="space-y-2">
              <label for="item_code" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-barcode text-blue-500 mr-2"></i>Item Code
              </label>
              <input type="text" id="item_code" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="Enter item code">
            </div>

            <!-- Name -->
            <div class="space-y-2">
              <label for="name" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-tag text-green-500 mr-2"></i>Item Name
              </label>
              <input type="text" id="name" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="Enter item name">
            </div>

            <!-- Category -->
            <div class="space-y-2">
              <label for="category" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-layer-group text-purple-500 mr-2"></i>Category
              </label>
              <input type="text" id="category" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="Enter category">
            </div>

            <!-- Quantity -->
            <div class="space-y-2">
              <label for="quantity_in_stock" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-cubes text-orange-500 mr-2"></i>Quantity in Stock
              </label>
              <input type="number" id="quantity_in_stock" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="0">
            </div>

            <!-- Unit -->
            <div class="space-y-2">
              <label for="unit" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-ruler text-indigo-500 mr-2"></i>Unit
              </label>
              <input type="text" id="unit" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="e.g., pcs, kg, liter">
            </div>

            <!-- Reorder Level -->
            <div class="space-y-2">
              <label for="reorder_level" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Reorder Level
              </label>
              <input type="number" id="reorder_level" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="Minimum stock level">
            </div>

            <!-- Price -->
            <div class="space-y-2">
              <label for="price_per_unit" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-dollar-sign text-green-600 mr-2"></i>Price per Unit
              </label>
              <input type="number" step="0.01" id="price_per_unit" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="0.00">
            </div>

            <!-- Supplier -->
            <div class="space-y-2">
              <label for="supplier_id" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-truck text-blue-600 mr-2"></i>Supplier
              </label>
              <input type="text" id="supplier_id" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm" placeholder="Select or enter supplier">
            </div>

            <!-- Description (full width) -->
            <div class="md:col-span-2 space-y-2">
              <label for="description" class="block text-sm font-semibold text-gray-700">
                <i class="fas fa-align-left text-gray-500 mr-2"></i>Description
              </label>
              <textarea id="description" rows="3" class="form-input-modern w-full rounded-lg px-4 py-3 text-sm resize-none" placeholder="Enter item description"></textarea>
            </div>

          </div>
        </div>

        <!-- Modal Footer -->
        <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3">
          <button type="button" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition-all duration-300 close-modal">
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
          <button id="insertBtn" type="button" class="px-6 py-3 btn-success-custom text-white font-semibold rounded-lg">
            <i class="fas fa-plus mr-2"></i>Add Item
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content Area -->
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
  <div class="max-w-7xl mx-auto">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden card-shadow">

      <!-- Action Buttons Section -->
      <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200">
        <div class="flex flex-wrap gap-4 items-center justify-between">
          <div class="flex gap-3">
            <button id="addSupplierBtn" class="btn-success-custom text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 hover:shadow-lg">
              <i class="fas fa-plus mr-2"></i>Add Inventory Item
            </button>
            <button id="updateSupplierBtn" class="btn-primary-custom text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 hover:shadow-lg">
              <i class="fas fa-edit mr-2"></i>Update Item
            </button>
          </div>

          <!-- Search and Filter Section -->
          <div class="flex gap-3 items-center">
            <div class="relative">
              <input type="text" id="searchInput" placeholder="Search items..." class="form-input-modern pl-10 pr-4 py-2 rounded-lg text-sm w-64">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
            <select id="categoryFilter" class="form-input-modern rounded-lg px-4 py-2 text-sm">
              <option value="">All Categories</option>
              <option value="electronics">Electronics</option>
              <option value="office">Office Supplies</option>
              <option value="maintenance">Maintenance</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Table Section -->
      <div class="p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800">
            <i class="fas fa-list mr-3 text-blue-500"></i>Inventory Supply List
          </h2>
          <div class="flex items-center space-x-4 text-sm text-gray-600">
            <div class="flex items-center">
              <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
              <span>In Stock</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
              <span>Low Stock</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
              <span>Out of Stock</span>
            </div>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table id="supplier_table" class="table-modern w-full">
            <thead class="gradient-bg text-white">
              <tr>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-barcode mr-2"></i>Item Code
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-tag mr-2"></i>Name
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-layer-group mr-2"></i>Category
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-align-left mr-2"></i>Description
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-cubes mr-2"></i>Quantity
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-ruler mr-2"></i>Unit
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-exclamation-triangle mr-2"></i>Reorder Level
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-dollar-sign mr-2"></i>Price
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold">
                  <i class="fas fa-truck mr-2"></i>Supplier
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/static/inventory_supply/inventory_supply.js"></script>

<!-- Quick Modal Fix -->
<script>
// Wait for everything to load, then override
$(window).on('load', function() {
    // Small delay to ensure all scripts have loaded
    setTimeout(function() {
        console.log('🔧 Enhanced modal fix loading...');
    // TEST SCRIPT
    console.log('🧪 ENHANCED TEMPLATE JAVASCRIPT IS LOADING!');

    // Test button functionality
    $("#testBtn").on('click', function() {
        alert('✅ JavaScript is working! Enhanced template is loaded correctly.');
        console.log('✅ Test button clicked - JavaScript is working!');
    });

    // Test modal button functionality
    $("#testModalBtn").on('click', function() {
        console.log('🔧 Test Modal button clicked');
        const modal = $("#supplierModal");
        console.log('Modal found:', modal.length > 0);

        if (modal.length > 0) {
            modal.removeClass('hidden');
            modal.css('display', 'flex');
            modal.show();
            console.log('✅ Modal should be visible via test button');
        } else {
            alert('❌ Modal not found!');
            console.error('❌ Modal #supplierModal not found');
        }
    });

    // Debug logs
    console.log('Enhanced template loaded');
    console.log('Add button exists:', $("#addSupplierBtn").length);
    console.log('Modal exists:', $("#supplierModal").length);

    // Debug: Check if button and modal exist
    if ($("#addSupplierBtn").length === 0) {
        console.error('❌ Add button not found! Looking for all buttons...');
        $('button').each(function(i) {
            console.log('Button ' + i + ':', $(this).attr('id'), $(this).text());
        });
    }

    if ($("#supplierModal").length === 0) {
        console.error('❌ Modal not found! Looking for all modals...');
        $('[role="dialog"]').each(function(i) {
            console.log('Modal ' + i + ':', $(this).attr('id'));
        });
    }

    // AGGRESSIVE OVERRIDE - Remove ALL click handlers and add ours
    $("#addSupplierBtn").off('click').unbind('click');

    // Add our click handler
    $("#addSupplierBtn").on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('✅ Add Inventory button clicked (ENHANCED VERSION)');

        const modal = $("#supplierModal");
        console.log('Modal element:', modal);
        console.log('Modal length:', modal.length);

        if (modal.length > 0) {
            console.log('🔧 Showing modal...');
            modal.removeClass('hidden');
            modal.css('display', 'flex');
            modal.show();
            console.log('✅ Modal should be visible now');

            // Call existing function if available
            if (typeof setSupplierAutocomplete === 'function') {
                console.log('🔧 Calling setSupplierAutocomplete...');
                setSupplierAutocomplete();
            }
        } else {
            console.error('❌ Modal not found when trying to show it');
        }

        return false;
    });

    // Also try to override using direct DOM event
    document.getElementById('addSupplierBtn')?.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('✅ Add Inventory button clicked (DOM VERSION)');

        const modal = document.getElementById('supplierModal');
        if (modal) {
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            console.log('✅ Modal shown via DOM');
        }

        return false;
    });

        // Call existing function if available
        if (typeof setSupplierAutocomplete === 'function') {
            setSupplierAutocomplete();
        }
    });

    $("#updateSupplierBtn").off('click').on('click', function() {
        console.log('Update Inventory button clicked');
        const modal = $("#supplierModalUpdating");
        modal.removeClass('hidden');
        modal.css('display', 'flex');
        modal.show();

        if (typeof setSupplierAutocomplete === 'function') {
            setSupplierAutocomplete();
        }
    });

    // Close modal functionality
    $(".close-modal").on('click', function() {
        const modal = $(this).closest('[role="dialog"]');
        modal.addClass('hidden');
        modal.css('display', 'none');
        modal.hide();
    });

    // Close on backdrop click
    $('[role="dialog"]').on('click', function(e) {
        if (e.target === this) {
            $(this).addClass('hidden');
            $(this).css('display', 'none');
            $(this).hide();
        }
    });

    }, 500); // 500ms delay to ensure all scripts loaded
});
</script>

{% endblock %}
